import org.zaproxy.zap.extension.ascan.ActiveScanRule
import org.parosproxy.paros.network.HttpMessage
import org.parosproxy.paros.core.scanner.Alert

class HTTPHeadersMisconfigurationRule extends ActiveScanRule {
    @Override
    public void scan(HttpMessage msg, String param, String value) {
        sendAndReceive(msg, false)
        def headers = msg.getResponseHeader().getHeaders()
        if (!headers.containsKey("X-Content-Type-Options") || !headers.containsKey("X-Frame-Options")) {
            bingo(Alert.RISK_MEDIUM, Alert.CONFIDENCE_MEDIUM, "HTTP Headers Misconfiguration", "Important security headers missing.", msg.getRequestHeader().getURI().toString(), param, value, headers.toString(), "", msg)
        }
    }
}
